@Library(['piper-lib']) _

pipeline {
    agent any

    // Define environment variables here, if needed
    environment {
        DOCKER_REGISTRY_CREDENTIALS = credentials('internalsapartifactory')
    }

    stages {
        stage('Build and Push Docker Image') {
            steps {
                script {
                    // Docker image destination and tag
                    def imageName = 'slvtestdemo.int.repositories.cloud.sap/imgFolder/testImg'
                    def imageTag = 'v1'

                    // Full image name with tag
                    def imageFullName = "${imageName}:${imageTag}"

                    // Path to your Dockerfile relative to Jenkins workspace
                    def dockerfilePath = './path/to/Dockerfile'

                    // Docker registry credentials ID for authentication
                    def dockerRegistryCredentialsId = 'internalsapartifactory'

                    // Build the Docker image using kanikoExecute
                    kanikoExecute(
                        script: this,
                        dockerfilePath: dockerfilePath,
                        buildOptions: ['--destination=' + imageFullName],
                        containerImageNameAndTag: imageFullName,
                        dockerConfigJsonCredentialsId: dockerRegistryCredentialsId
                    )
                }
            }
        }
    }
}
